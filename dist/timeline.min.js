/*!
 * jQuery Timeline Plugin
 * ------------------------
 * Version: 1.0.6
 * Author: Ka2 ( https://ka2.org/ )
 * Repository: https://github.com/ka215/jquery.timeline
 * Lisenced: MIT
 */
!function(q){var b,n=0,c={init:function(m){var d=q.extend(!0,{type:"bar",scale:"days",startDatetime:"currently",datetimePrefix:"",showHeadline:!0,datetimeFormat:{full:"j M Y",year:"Y",month:"M Y",day:"D, j M",years:"Y",months:"F",days:"j",meta:"Y/m/d H:i",metato:""},minuteInterval:30,zerofillYear:!1,range:3,rows:5,rowHeight:40,height:"auto",minGridPer:2,minGridSize:30,rangeAlign:"current",naviIcon:{left:"jqtl-circle-left",right:"jqtl-circle-right"},showPointer:!0,duration:150},m);return this.each(function(){var e=q(this),t=e.data("timeline"),i=q("<div />",{title:e.find(".timeline-headline").text(),type:d.type,scale:d.scale,"start-datetime":d.startDatetime,"datetime-prefix":d.datetimePrefix,"show-headline":d.showHeadline?1:0,"datetime-format-full":d.datetimeFormat.full||"j M Y","datetime-format-year":d.datetimeFormat.year||"Y","datetime-format-month":d.datetimeFormat.month||"M Y","datetime-format-day":d.datetimeFormat.day||"D, j M","datetime-format-years":d.datetimeFormat.years||"Y","datetime-format-months":d.datetimeFormat.months||"F","datetime-format-days":d.datetimeFormat.days||"j","datetime-format-meta":d.datetimeFormat.meta||"Y/m/d H:i","datetime-format-metato":d.datetimeFormat.metato||"","minute-interval":d.minuteInterval,"zerofill-year":d.zerofillYear?1:0,range:d.range,rows:d.rows,"row-height":d.rowHeight,"timeline-height":d.height,"min-grid-per":d.minGridPer,"min-grid-size":d.minGridSize,"range-align":d.rangeAlign,"navi-icon-left":d.naviIcon.left||"jqtl-circle-left","navi-icon-right":d.naviIcon.right||"jqtl-circle-right","show-pointer":d.showPointer?1:0,duration:d.duration,text:""});if(e.on("click.timeline",".timeline-to-prev",c.dateback),e.on("click.timeline",".timeline-to-next",c.dateforth),e.on("click.timeline",".timeline-node",c.openEvent),e.on("align.timeline",c.alignment),e.on("afterRender.timeline",function(){q(this).off("afterRender.timeline")}),t){var a=0,r=setInterval(function(){1==++a&&(f(e),clearInterval(r))},d.duration);f(e)}else{var n,l,s,o;switch(e.data("timeline",{target:e,timeline:i}),b=d.rowHeight,"currently"===d.startDatetime?n=X(!0):(n=new Date(x(d.startDatetime)),o=/-|\//,s=d.startDatetime.split(o),Number(s[0])<100&&n.setFullYear(Number(s[0]))),d.scale){case"years":l=n.getFullYear()+"/01/01 00:00:00";break;case"months":l=n.getFullYear()+"/"+(n.getMonth()+1)+"/01 00:00:00";break;case"days":l=n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+" 00:00:00";break;default:l=n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+" "+l.getHours()+":00:00"}e.data("timeline").timeline.attr("actual-start-datetime",l),h(e),u(e),e.trigger("align.timeline",[d.rangeAlign,0]),e.css("visibility","visible"),f(e),e.trigger("afterRender.timeline",[m])}})},initialized:function(i){return this.each(function(){var e=q(this),t=e.data("timeline");t&&"function"==typeof i&&($('Fired "initialized" method after initialize this plugin.'),i(e,t))})},destroy:function(){return this.each(function(){var e=q(this),t=e.data("timeline");q(window).off(".timeline"),t&&(t.timeline.remove(),e.removeData("timeline"))})},render:function(l){return this.each(function(){var e,t,i,a,r=q(this),n=r.data("timeline");switch("type"in l&&n.timeline.attr("type",l.type),"scale"in l&&n.timeline.attr("scale",l.scale),"startDatetime"in l&&n.timeline.attr("start-datetime",l.startDatetime),"datetimePrefix"in l&&n.timeline.attr("datetime-prefix",l.datetimePrefix),"showHeadline"in l&&n.timeline.attr("show-headline",l.showHeadline?1:0),"datetimeFormat"in l&&(null!=typeof l.datetimeFormat.full&&n.timeline.attr("datetime-format-full",l.datetimeFormat.full),null!=typeof l.datetimeFormat.year&&n.timeline.attr("datetime-format-year",l.datetimeFormat.year),null!=typeof l.datetimeFormat.month&&n.timeline.attr("datetime-format-month",l.datetimeFormat.month),null!=typeof l.datetimeFormat.day&&n.timeline.attr("datetime-format-day",l.datetimeFormat.day),null!=typeof l.datetimeFormat.years&&n.timeline.attr("datetime-format-years",l.datetimeFormat.years),null!=typeof l.datetimeFormat.months&&n.timeline.attr("datetime-format-months",l.datetimeFormat.months),null!=typeof l.datetimeFormat.days&&n.timeline.attr("datetime-format-days",l.datetimeFormat.days),null!=typeof l.datetimeFormat.meta&&n.timeline.attr("datetime-format-meta",l.datetimeFormat.meta),null!=typeof l.datetimeFormat.metato&&n.timeline.attr("datetime-format-metato",l.datetimeFormat.metato)),"minuteInterval"in l&&n.timeline.attr("minute-interval",l.minuteInterval),"zerofillYear"in l&&n.timeline.attr("zerofill-year",l.zerofillYear?1:0),"range"in l&&n.timeline.attr("range",l.range),"rows"in l&&n.timeline.attr("rows",l.rows),"rowHeight"in l&&n.timeline.attr("row-height",l.rowHeight),"height"in l&&n.timeline.attr("timeline-height",l.height),"minGridPer"in l&&n.timeline.attr("min-grid-per",l.minGridPer),"minGridSize"in l&&n.timeline.attr("min-grid-size",l.minGridSize),"rangeAlign"in l&&n.timeline.attr("range-align",l.rangeAlign),"naviIcon"in l&&(null!=typeof l.naviIcon.left&&n.timeline.attr("navi-icon-left",l.naviIcon.left),null!=typeof l.naviIcon.right&&n.timeline.attr("navi-icon-right",l.naviIcon.right)),"showPointer"in l&&n.timeline.attr("show-pointer",l.showPointer?1:0),"duration"in l&&n.timeline.attr("duration",l.duration),"currently"===n.timeline.attr("start-datetime")?e=X(!0):(e=new Date(x(n.timeline.attr("start-datetime"))),a=/-|\//,i=n.timeline.attr("start-datetime").split(a),Number(i[0])<100&&e.setFullYear(Number(i[0]))),n.timeline.attr("scale")){case"years":t=e.getFullYear()+"/01/01 00:00:00";break;case"months":t=e.getFullYear()+"/"+(e.getMonth()+1)+"/01 00:00:00";break;case"days":t=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" 00:00:00";break;default:t=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+t.getHours()+":00:00"}n.timeline.attr("actual-start-datetime",t),r.find(".timeline-container").empty().removeClass("timeline-container"),h(r),u(r),f(r),r.trigger("align.timeline",[n.timeline.attr("range-align"),0]),r.trigger("afterRender.timeline",[l])})},show:function(){return this.each(function(){q(this).css("display","block").css("visibility","visible")})},hide:function(){return this.each(function(){q(this).css("visibility","hidden").css("display","none")})},dateback:function(e){$('Fired "dateback" method',this,e),e.preventDefault();var t=q(this).parents(".timeline-container"),i=t.data("timeline"),a=t.find(".timeline-body")[0].clientWidth,r=t.find(".timeline-wrapper")[0].scrollWidth,n=t.find(".timeline-body").scrollLeft(),l=0;return a<r&&(l=(l=1<n/a?n-a:n-(r-a)/Number(i.timeline.attr("range")))<0?0:l,t.find(".timeline-body").animate({scrollLeft:l},i.timeline.attr("duration"))),this},dateforth:function(e){$('Fired "dateforth" method',this,e),e.preventDefault();var t=q(this).parents(".timeline-container"),i=t.data("timeline"),a=t.find(".timeline-body")[0].clientWidth,r=t.find(".timeline-wrapper")[0].scrollWidth,n=t.find(".timeline-body").scrollLeft(),l=0;return a<r&&(l=r-a+1<(l=1<(r-n)/a?n+a:n+(r-a)/Number(i.timeline.attr("range")))?r-a+1:l,t.find(".timeline-body").animate({scrollLeft:l},i.timeline.attr("duration"))),this},alignment:function(){var e=1<arguments.length?Array.prototype.slice.call(arguments,1):[arguments[0]],t=e[0].toLowerCase(),i=q(this).data("timeline"),a=void 0!==e[1]?String(e[1]).toLowerCase():i.timeline.attr("duration");$('Fired "alignment" method',q(this),t,a);var r=q(this).find(".timeline-body")[0].clientWidth,n=q(this).find(".timeline-wrapper")[0].scrollWidth,l=0;if(r<n){var s;switch(t){case"left":l=0;break;case"right":l=n-r+1;break;case"center":l=(n-r)/2;break;case"current":l=-1<(s=B(X(!0),i))?n-r+1<s-r/2?n-r+1:s-r/2:n-r+1;break;case"latest":var o,m,d,c=new Function("return "+i.timeline.text())();q.each(c,function(e,t){m=U("U",t.start),0==e?(o=m,d=e):o<=m&&(o=m,d=e)}),l=-1<(s=B(new Date(x(c[d].start)),i))?n-r+1<s-r/2?n-r+1:s-r/2:n-r+1;break;default:l=0;var h="#"+t;q(h).length&&(l=n-r+1<(s=q(h).position().left)-r/2?n-r+1:s-r/2)}-1!=q.inArray(a,["slow","normal","fast"])||0<Number(a)?q(this).find(".timeline-body").animate({scrollLeft:l},a):q(this).find(".timeline-body").scrollLeft(l)}return this},getOptions:function(){$('Fired "getOptions" method.');var e=q(this).data("timeline");return{title:e.timeline.attr("title"),type:e.timeline.attr("type"),scale:e.timeline.attr("scale"),startDatetime:e.timeline.attr("start-datetime"),datetimePrefix:e.timeline.attr("datetime-prefix"),showHeadline:1==Number(e.timeline.attr("show-headline")),datetimeFormat:{full:e.timeline.attr("datetime-format-full"),year:e.timeline.attr("datetime-format-year"),month:e.timeline.attr("datetime-format-month"),day:e.timeline.attr("datetime-format-day"),years:e.timeline.attr("datetime-format-years"),months:e.timeline.attr("datetime-format-months"),days:e.timeline.attr("datetime-format-days")},minuteInterval:Number(e.timeline.attr("minute-interval")),zerofillYear:1==Number(e.timeline.attr("zerofill-year")),range:Number(e.timeline.attr("range")),rows:Number(e.timeline.attr("rows")),rowHeight:Number(e.timeline.attr("row-height")),height:"auto"===e.timeline.attr("timeline-height")?"auto":Number(e.timeline.attr("timeline-height")),minGridPer:Number(e.timeline.attr("min-grid-per")),minGridSize:Number(e.timeline.attr("min-grid-size")),rangeAlign:e.timeline.attr("range-align"),naviIcon:{left:e.timeline.attr("navi-icon-left"),right:e.timeline.attr("navi-icon-right")},showPointer:e.timeline.attr("show-pointer"),events:new Function("return "+e.timeline.text())()}},addEvent:function(n,l){return this.each(function(){var e=q(this),t=e.data("timeline"),i=new Function("return "+t.timeline.text())(),a=1,r=[a];0<n.length&&(q.each(i,function(e,t){r.push(Number(t.eventId))}),a=Math.max.apply(null,r)+1,q.each(n,function(e,t){t.eventId=a,a++,i.push(t)}),t.timeline.text(JSON.stringify(i))),f(e),q(this).trigger("align.timeline",["evt-"+(a-1)]),t&&"function"==typeof l&&($('Fired "addEvent" method after events addition.'),l(e,t))})},removeEvent:function(){var r,n;return n=0==arguments.length?(r="all",null):1==arguments.length?"function"==typeof arguments[0]?(r="all",arguments[0]):(r=arguments[0],null):(r=arguments[0],arguments[1]),this.each(function(){var e=q(this),t=e.data("timeline"),i=new Function("return "+t.timeline.text())();if("all"===r)i=[];else{var a=[];q.each(i,function(e,t){-1==q.inArray(t.eventId,r)&&a.push(t)}),i=a}t.timeline.text(JSON.stringify(i)),f(e),t&&"function"==typeof n&&($('Fired "removeEvent" method after events removing.'),n(e,t))})},updateEvent:function(s,i){return void 0!==s&&this.each(function(){var r,e=q(this),t=e.data("timeline"),n=new Function("return "+t.timeline.text())(),l=[];0<s.length&&q.each(s,function(e,t){l.push(t.eventId)}),0<n.length&&0<l.length&&(q.each(n,function(e,i){var a;-1!=q.inArray(i.eventId,l)&&(q.each(s,function(e,t){if(t.eventId==i.eventId)return r=(a=t).eventId,!1}),n[e]=a)}),t.timeline.text(JSON.stringify(n))),f(e),q(this).trigger("align.timeline",["evt-"+r]),t&&"function"==typeof i&&($('Fired "updateEvent" method after events updating.'),i(e,t))})},openEvent:function(e){var r=Number(q(e.target).attr("id").replace("evt-","")),t=e.delegateTarget;return""!==r&&0!=r&&q(t).each(function(){var i,e=q(this).data("timeline"),t=new Function("return "+e.timeline.text())(),a={start:e.timeline.attr("datetime-format-meta"),end:e.timeline.attr("datetime-format-metato")};q.each(t,function(e,t){if(t.eventId==r)return i=t,!1}),q(this).find(".timeline-node").each(function(){q(this).attr("id")==="evt-"+r?q(this).addClass("active"):q(this).removeClass("active")}),q(this).trigger("align.timeline",["evt-"+r]),function(e,t){if(0==q(".timeline-event-view").length)return!0;q(".timeline-event-view").empty();var i,a=q("<div />",{addClass:"timeline-event-header"}),r=q("<h3 />",{addClass:"timeline-event-label"}),n=q("<div />",{addClass:"timeline-event-meta"}),l=q("<div />",{addClass:"timeline-event-body"}),s=q("<div />",{addClass:"timeline-event-footer"});r.text(e.label),""===t.end&&(t.end=t.start);i='<span class="timeline-event-start-date">'+U(t.start,e.start)+"</span>",e.end&&(i+='<span class="timeline-event-date-separator"></span>',i+='<span class="timeline-event-end-date">'+U(t.end,e.end)+"</span>");a.append(r.prop("outerHTML")+n.append(i).prop("outerHTML")),e.content&&l.html(e.content);return q(".timeline-event-view").append(a.prop("outerHTML")+l.prop("outerHTML")+s.prop("outerHTML")),!0}(i,a)&&i.callback&&($('Fired "openEvent" method after event shown.'),Function.call(null,"return "+i.callback)())})}};function h(e){var t,i,a,r=q(e),n=r.data("timeline");$('Called "renderTimeline" function',r,n.timeline),a=/-|\/|\s|\:/,i=n.timeline.attr("actual-start-datetime").split(a);var l=new Date(Number(i[0]),Number(i[1])-1,Number(i[2]),Number(i[3]),Number(i[4]),Number(i[5]));Number(i[0])<100&&l.setFullYear(Number(i[0]));var s,o,m=q("<div />",{addClass:"timeline-header"}),d=q("<div />",{addClass:"timeline-body"}),c=q("<div />",{addClass:"timeline-footer"}),h=q("<div />",{addClass:"timeline-wrapper"}),u=q("<table />",{addClass:"timeline-timetable timeline-scale"}),f=q("<div />",{addClass:"timeline-events"}),g=q("<table />",{addClass:"timeline-timetable timeline-grids"}),p=q("<div />",{addClass:"timeline-needle-pointer"}),y=q("<div />",{addClass:"timeline-events default-events"}),v=new Date(l),b={years:{medium_scale:"months",medium_cols:12,small_scale:"days",small_cols:Number(n.timeline.attr("min-grid-per"))},months:{medium_scale:"days",medium_cols:new Date(l.getFullYear(),l.getMonth()+1,0).getDate(),small_scale:"hours",small_cols:Number(n.timeline.attr("min-grid-per"))},days:{medium_scale:"hours",medium_cols:24,small_scale:"minutes",small_cols:Number(n.timeline.attr("min-grid-per"))}},w=n.timeline.attr("scale"),x=b[w].medium_scale,M=b[w].small_scale,F=Number(n.timeline.attr("min-grid-per"))*Number(n.timeline.attr("min-grid-size")),D=[b[w].medium_cols];if(r.hasClass("timeline-container")||r.addClass("timeline-container"),0<r.find(".timeline-events").length&&(r.find(".timeline-events").children().clone().appendTo(y),function(e,t){if(0<q(e).children().length){var i=[],a=[],r=1;q(e).children().each(function(){if(q(this).data("timelineNode")){var e=new Function("return "+q(this).data("timelineNode"))();e.label=q(this).text(),e.eventId&&a.push(Number(e.eventId)),i.push(e)}}),0<i.length&&(r=0<a.length?Math.max.apply(null,a)+1:r,i.forEach(function(e,t,i){e.eventId||(i[t].eventId=r,r++)}),t.timeline.text(JSON.stringify(i)))}}(y,n)),"point"===n.timeline.attr("type")||"mixed"===n.timeline.attr("type"))var k=q("<canvas />",{addClass:"timeline-line-canvas"});if(r.empty(),o=("years"===n.timeline.attr("scale")?v.setFullYear(v.getFullYear()+Number(n.timeline.attr("range"))):"months"===n.timeline.attr("scale")?v.setMonth(v.getMonth()+Number(n.timeline.attr("range"))):v.setDate(v.getDate()+Number(n.timeline.attr("range"))),v.getTime()),v.setTime(o-1),"days"===x&&1<Number(n.timeline.attr("range")))for(t=1;t<Number(n.timeline.attr("range"));t++)D.push(new Date(l.getFullYear(),l.getMonth()+1+t,0).getDate());else for(t=1;t<Number(n.timeline.attr("range"));t++)D.push(b[w].medium_cols);if(Q(n.timeline.attr("show-headline"))){var N,Y,T,C,H;switch(n.timeline.attr("scale")){case"years":T=C="",1==n.timeline.attr("zerofill-year")&&(l.getFullYear()<100?T="00":l.getFullYear()<1e3&&(T="0"),v.getFullYear()<100?C="00":v.getFullYear()<1e3&&(C="0")),N=n.timeline.attr("datetime-prefix")+T+U(n.timeline.attr("datetime-format-year"),l),Y=n.timeline.attr("datetime-prefix")+C+U(n.timeline.attr("datetime-format-year"),v);break;case"months":N=n.timeline.attr("datetime-prefix")+U(n.timeline.attr("datetime-format-month"),l),Y=n.timeline.attr("datetime-prefix")+U(n.timeline.attr("datetime-format-month"),v);break;case"days":N=n.timeline.attr("datetime-prefix")+U(n.timeline.attr("datetime-format-day"),l),Y=n.timeline.attr("datetime-prefix")+U(n.timeline.attr("datetime-format-day"),v)}H='<span class="timeline-from-date">'+N+'</span><span class="timeline-to-date">'+Y+"</span>",m.append('<h3 class="timeline-headline">'+H+"</h3>")}var S,z,I,L,j="<tr>",A="<tr>",E="<tr>";for(s=R(D)*b[w].small_cols,n.timeline.attr("total-cols",s),t=0;t<Number(n.timeline.attr("range"));t++){switch(j+='<th colspan="'+D[t]*b[w].small_cols+'" class="scale-major scale-'+w+'">',S=new Date(l),w){case"years":S.setFullYear(S.getFullYear()+t),T="",1==n.timeline.attr("zerofill-year")&&(S.getFullYear()<100?T="00":S.getFullYear()<1e3&&(T="0")),I=T+U(n.timeline.attr("datetime-format-years"),S);break;case"months":S.setMonth(S.getMonth()+t),I=U(n.timeline.attr("datetime-format-months"),S);break;case"days":S.setDate(S.getDate()+t),I=U(n.timeline.attr("datetime-format-days"),S)}j+=I+"</th>"}for(j+="</tr>",t=0;t<R(D);t++){switch(S=new Date(l),x){case"months":z=t%b[w].medium_cols,I=F<18?"":z+1,L=new Date(S.getFullYear(),S.getMonth()+t,1).getTime();break;case"days":S.setDate(S.getDate()+t),I=F<20?"":S.getDate(),L=S.getTime();break;case"hours":z=t%b[w].medium_cols,I=F<40?"":z+":00",L=S.setTime(S.getTime()+36e5*t)}A+='<th colspan="'+b[w].small_cols+'" class="scale-medium scale-'+x+'" data-cell-datetime="'+L+'">',A+=I+"</th>"}for(A+="</tr>",t=0;t<s;t++)E+='<th class="scale-small scale-'+M+'"><span class="spacer-cell"></span></th>';var _="<tr>";for(t=0;t<s;t++)_+='<td class="scale-small"><span class="spacer-cell"></span></td>';if(_+="</tr>",Q(n.timeline.attr("show-pointer"))){var O=B(X(!0),n);!1!==O?p.css("left",O+"px"):p.css("display","none")}else p.css("display","none");var P=q("<div />",{addClass:"timeline-loader",css:{display:"block"}});P.append('<i class="jqtl-spinner"></i><span class="sr-only">Loading...</span>');var W='<div class="timeline-nav">',J=""===n.timeline.attr("navi-icon-left")?"jqtl-circle-left":n.timeline.attr("navi-icon-left"),G=""===n.timeline.attr("navi-icon-right")?"jqtl-circle-right":n.timeline.attr("navi-icon-right");return W+='<a href="javascript:void(0);" class="timeline-to-prev '+(/^jqtl-circle-.*$/.test(J)?"timeline-to-prev-default":"timeline-to-prev-custom")+'"><i class="'+J+'"></i></a>',W+='<a href="javascript:void(0);" class="timeline-to-next '+(/^jqtl-circle-.*$/.test(G)?"timeline-to-next-default":"timeline-to-next-custom")+'"><i class="'+G+'"></i></a>',W+="</div>",u.append("<thead>"+j+A+E+"</thead>"),g.append("<tbody>"+_+"</tbody>"),"point"===n.timeline.attr("type")||"mixed"===n.timeline.attr("type")?h.append(u.prop("outerHTML")+f.prop("outerHTML")+k.prop("outerHTML")+g.prop("outerHTML")+p.prop("outerHTML")):h.append(u.prop("outerHTML")+f.prop("outerHTML")+g.prop("outerHTML")+p.prop("outerHTML")),d.append(h),c.append(W),r.append(m),r.append(d),r.append(c),r.append(P.prop("outerHTML")),r}function u(e){var t=q(e),i=t.data("timeline");n="auto"===i.timeline.attr("timeline-height")||"number"!=typeof i.timeline.attr("timeline-height")?Number(i.timeline.attr("rows"))*Number(i.timeline.attr("row-height")):Number(i.timeline.attr("timeline-height"));var a={width:t.find(".timeline-timetable.timeline-scale").outerWidth(),height:63};t.find(".timeline-wrapper")[0].offsetHeight!=a.height+n&&(t.find(".timeline-wrapper").css("height",a.height+n+"px"),t.find(".timeline-events").css("height",n+"px"),t.find(".timeline-line-canvas").css("height",n+"px").attr("width",a.width).attr("height",n),t.find(".timeline-grids").css("height",n+"px")),i.timeline.attr("min-grid-size",Number(i.timeline.attr("min-grid-size"))<5?30:Number(i.timeline.attr("min-grid-size"))),t.find(".spacer-cell").width()!=i.timeline.attr("min-grid-size")-1&&t.find(".spacer-cell").css("width",i.timeline.attr("min-grid-size")-1+"px");var r=-1*((t.find(".timeline-body").outerHeight()-t.find(".timeline-scale").outerHeight())/2+t.find(".timeline-to-prev").outerHeight());return t.find(".timeline-to-prev").css("top",r+"px"),t.find(".timeline-to-next").css("top",r+"px"),t.find(".timeline-body").scroll(function(){var e=q(this).scrollLeft();e<1?t.find(".timeline-to-prev").hide():e>=a.width-q(this).outerWidth()-2?t.find(".timeline-to-next").hide():(t.find(".timeline-to-prev").show(),t.find(".timeline-to-next").show())}),t}function f(e){var m=q(e),t=m.data("timeline"),i=new Function("return "+t.timeline.text())(),d=new Date(x(t.timeline.attr("actual-start-datetime"))),c=new Date(d),h=t.timeline.attr("type"),u=t.timeline.attr("scale"),a=Number(t.timeline.attr("range")),f=Number(t.timeline.attr("row-height")),r=Number(t.timeline.attr("total-cols")),g=Number(t.timeline.attr("min-grid-per")),p=Number(t.timeline.attr("min-grid-size")),y={x:0,y:0,w:0},v=p*r-1;switch(m.find(".timeline-loader").css("display","block"),u){case"years":c.setYear(c.getFullYear()+a);break;case"months":c.setMonth(c.getMonth()+a-1);break;case"days":c.setDate(c.getDate()+a)}console.log(u,c),m.find(".timeline-events").empty(),i.forEach(function(e){if(e.start){var i,t=new Date(x(e.start)),a=null==e.end?new Date(x(e.start)):new Date(x(e.end)),r=2592e6,n=864e5,l=36e5,s=g*p;if(w(t,d,c)){switch(u){case"years":y.x=Math.round((t-d)*v/(c-d));break;case"months":y.x=Math.floor((t-d)/n*s);break;case"days":y.x=Math.floor((t-d)/l*s)}if(y.y=void 0!==e.row?(e.row-1)*f:0,w(a,d,c)){switch(u){case"years":y.w=Math.floor((a-d)/r*s-y.x);break;case"months":y.w=Math.floor((a-d)/n*s-y.x);break;case"days":y.w=Math.floor((a-d)/l*s-y.x)}0==y.w&&(y.w=1)}else switch(u){case"years":y.w=Math.floor((c-d)/r*s-y.x);break;case"months":y.w=Math.floor((c-d)/n*s-y.x);break;case"days":y.w=Math.floor((c-d)/l*s-y.x)}}else if(w(a,d,c))switch(y.x=0,y.y=void 0!==e.row?(e.row-1)*f:0,u){case"years":y.w=Math.floor((a-d)/r*s);break;case"months":y.w=Math.floor((a-d)/n*s);break;case"days":y.w=Math.floor((a-d)/l*s)}else if(w(d,t,a)&&w(c,t,a))switch(y.x=0,y.y=void 0!==e.row?(e.row-1)*f:0,u){case"years":y.w=Math.floor((c-d)/r*s);break;case"months":y.w=Math.floor((c-d)/n*s);break;case"days":y.w=Math.floor((c-d)/l*s)}else y.w=0;if(0<y.w){if("point"===h){var o=e.margin?Number(e.margin):2;o=f/2<(o=o<0?0:o)?f/2-1:o,i=q("<div />",{addClass:"timeline-node timeline-event-pointer",id:"evt-"+e.eventId,css:{left:y.x-Math.floor(f/2)+o+"px",top:y.y+o+"px",width:f-2*o+"px",height:f-2*o+"px"},title:e.label}),e.bdColor?i.css("border-color",e.bdColor):e.bgColor&&i.css("border-color",e.bgColor),e.image&&i.css("background-image","url("+e.image+")"),e.relation&&q.each(e.relation,function(e,t){-1==q.inArray(e,["before","after","size"])||isNaN(t)?"curve"===e?-1!=q.inArray(t,["lt","rt","lb","rb"])&&i.attr("data-relay-curve",t):i.attr("data-relay-"+e,t):i.attr("data-relay-"+e,Number(t))})}else i=q("<div />",{addClass:"timeline-node timeline-text-truncate",id:"evt-"+e.eventId,css:{left:y.x+"px",top:y.y+"px",width:y.w+"px"},text:e.label}),e.color&&i.css("color",e.color),y.w<p&&i.css("padding-left","1.5rem").css("padding-right","0").css("text-overflow","clip");e.bgColor&&i.css("background-color",e.bgColor),e.extend&&q.each(e.extend,function(e,t){i.attr("data-"+e,t)}),m.find(".timeline-events").append(i.prop("outerHTML"))}}}),m.find(".timeline-loader").css("display","none"),"point"!==h&&"mixed"!==h||(!function(e){var o,t=e.find(".timeline-node.timeline-event-pointer"),m=e.find(".timeline-line-canvas")[0];if(!m.getContext)return;function d(e,t,i){if("object"==typeof e&&"object"==typeof t){i=i||!1;var a,r={x:Math.abs((e.x-t.x)/b),y:Math.abs((e.y-t.y)/b)};if(o.beginPath(),o.moveTo(e.x,e.y),!1!==i){switch(i){case"lt":a={relayStartX:e.x,relayStartY:t.y+b,cpx:e.x,cpy:t.y,relayEndX:e.x+b,relayEndY:t.y};break;case"rt":a={relayStartX:t.x-b,relayStartY:e.y,cpx:t.x,cpy:e.y,relayEndX:t.x,relayEndY:e.y+b};break;case"lb":a={relayStartX:e.x,relayStartY:t.y-b,cpx:e.x,cpy:t.y,relayEndX:e.x+b,relayEndY:t.y};break;case"rb":a={relayStartX:t.x-b,relayStartY:e.y,cpx:t.x,cpy:e.y,relayEndX:t.x,relayEndY:e.y-b}}(1<r.x||1<r.y)&&o.lineTo(a.relayStartX,a.relayStartY),o.quadraticCurveTo(a.cpx,a.cpy,a.relayEndX,a.relayEndY)}o.lineTo(t.x,t.y),o.stroke()}}o=m.getContext("2d"),t.each(function(){var e,t,i,a,r,n,l=null==q(this).data("relayLinecolor")?q(this).css("border-left-color"):q(this).data("relayLinecolor"),s=null==q(this).data("relayLinesize")?Math.round(b/10):q(this).data("relayLinesize");o.strokeStyle=l,o.lineWidth=s,o.lineJoin="round",o.lineCap="round",a={x:(b-o.lineWidth)/2,y:b/2},r=Math.floor((b-q(this)[0].offsetWidth)/2),e={x:q(this)[0].offsetLeft-r+a.x,y:Math.floor(q(this)[0].offsetTop/b)*b+a.y},null!=q(this).data("relayBefore")&&(0<q(this).data("relayBefore")?0<q("#evt-"+q(this).data("relayBefore")).length&&(r=Math.floor((b-q("#evt-"+q(this).data("relayBefore"))[0].offsetWidth)/2),t={x:q("#evt-"+q(this).data("relayBefore"))[0].offsetLeft-r+a.x,y:Math.floor(q("#evt-"+q(this).data("relayBefore"))[0].offsetTop/b)*b+a.y}):t={x:0,y:e.y},t&&(n=(t.y-e.y)/b,0<Math.abs(n)&&null!=q(this).data("relayCurve")&&-1!=q.inArray(q(this).data("relayCurve"),["lt","rt","lb","rb"])?d(t,e,q(this).data("relayCurve")):d(t,e))),null!=q(this).data("relayAfter")&&(0<q(this).data("relayAfter")?0<q("#evt-"+q(this).data("relayAfter")).length&&(r=Math.floor((b-q("#evt-"+q(this).data("relayAfter"))[0].offsetWidth)/2),i={x:q("#evt-"+q(this).data("relayAfter"))[0].offsetLeft-r+a.x,y:Math.floor(q("#evt-"+q(this).data("relayAfter"))[0].offsetTop/b)*b+a.y}):i={x:m.width,y:e.y},i&&(n=(e.y-i.y)/b,0<Math.abs(n)&&null!=q(this).data("relayCurve")&&-1!=q.inArray(q(this).data("relayCurve"),["lt","rt","lb","rb"])?d(e,i,q(this).data("relayCurve")):d(e,i)))})}(m),m.find(".timeline-event-pointer").hover(function(e){var t;"mouseenter"===e.type?(t={left:parseInt(q(this).css("left")),top:parseInt(q(this).css("top")),width:parseInt(q(this).css("width")),height:parseInt(q(this).css("height"))},q(this).attr("data-default-axis",JSON.stringify(t)),q(this).hasClass("hovered")||q(this).addClass("hovered").animate({left:t.left-f/10,top:t.top-f/10,width:t.width+f/10*2,height:t.height+f/10*2},0)):"mouseleave"===e.type&&(t=q(this).data("defaultAxis"),q(this).css("left",t.left+"px").css("top",t.top+"px").css("width",t.width+"px").css("height",t.height+"px"),q(this).removeAttr("data-default-axis"),q(this).hasClass("hovered")&&q(this).removeClass("hovered"))}))}q.fn.timeline=function(e){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void q.error("Method "+e+" does not exist on jQuery.timeline."):c.init.apply(this,arguments)};var i=function(){return q.ajax({type:"GET"}).done(function(e,t,i){q("body").data("serverDate",new Date(x(i.getResponseHeader("Date"))))}).promise()};function X(e){var t=new Date;return e&&i().then(function(){t=q("body").data("serverDate"),q.removeData("body","serverDate")},function(){t=new Date}),t}function w(e,t,i){var a=new Date(e).getTime(),r=new Date(t).getTime(),n=new Date(i).getTime();return 0<=a-r&&0<=n-a}function B(e,t){e="[object Date]"===Object.prototype.toString.call(e)?e:new Date(x(e));var i,a,r=t.timeline,n=new Date(x(r.attr("actual-start-datetime"))),l=new Date(n),s=r.attr("scale"),o=Number(r.attr("range")),m=Number(r.attr("total-cols")),d=Number(r.attr("min-grid-per")),c=Number(r.attr("min-grid-size")),h=c*m-1,u=d*c;switch(s){case"years":i=(l=new Date(l.setFullYear(l.getFullYear()+o))).getTime(),l.setTime(i-1);break;case"months":i=(l=new Date(l.setMonth(l.getMonth()+o))).getTime(),l.setTime(i-1);break;case"days":i=(l=new Date(l.setDate(l.getDate()+o))).getTime(),l.setTime(i-1)}if(w(e,n,l)){switch(s){case"years":a=Math.round((e-n)*h/(l-n));break;case"months":a=Math.floor((e-n)/864e5*u);break;case"days":a=Math.floor((e-n)/36e5*u)}return a}return!1}function x(e){return e.replace(/-/g,"/")}function R(e){return e.reduce(function(e,t){return e+t})}function p(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(e[i]);return t}function y(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}function v(e,t){var i,a=(i="0",Array(t-1+1).join(i));return String(e).length==t?e:(a+e).substr(-1*e)}function U(e,t){e=e||"";var s="[object Date]"===Object.prototype.toString.call(t)?t:new Date(x(t)),o={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"},m={Sun:"Sunday",Mon:"Monday",Tue:"Tuesday",Wed:"Wednesday",Thu:"Thurseday",Fri:"Friday",Sat:"Saturday"},i=["am","pm"],d=e.split(""),c="",h=!1,u=function(e){var t=new Date(e.getFullYear(),e.getMonth()+1,1);return t.setTime(t.getTime()-1),t.getDate()},f=function(e){var t=e.getHours();return 12<t?t-12:t},g=function(e){return 12<e.getHours()?i[1]:i[0]};if(""===e)return s;if(0<q(".timeline-container").length){var a=q(".timeline-container").eq(0).data("timeline").timeline;o=a.attr("i18n-month")?JSON.parse(a.attr("i18n-month")):o,m=a.attr("i18n-day")?JSON.parse(a.attr("i18n-day")):m,i=a.attr("i18n-ma")?JSON.parse(a.attr("i18n-ma")):i}return d.forEach(function(e,t){var i,a,r,n,l;if(!1!==h)return!(h=!1);switch(e){case"Y":case"o":i=s.getFullYear();break;case"y":i=(""+s.getFullYear()).slice(-2);break;case"m":i=("0"+(s.getMonth()+1)).slice(-2);break;case"n":i=s.getMonth()+1;break;case"F":i=p(o)[s.getMonth()];break;case"M":i=y(o)[s.getMonth()];break;case"d":i=("0"+s.getDate()).slice(-2);break;case"j":i=s.getDate();break;case"S":i=["st","nd","rd","th"][(l=s.getDate(),1==l||2==l||3==l||21==l||22==l||23==l||31==l?Number((""+l).slice(-1)-1):3)];break;case"w":case"W":i=s.getDay();break;case"l":i=p(m)[s.getDay()];break;case"D":i=y(m)[s.getDay()];break;case"N":i=0===s.getDay()?7:s.getDay();break;case"a":i=g(s);break;case"A":i=g(s).toUpperCase();break;case"g":i=f(s);break;case"h":i=("0"+f(s)).slice(-2);break;case"G":i=s.getHours();break;case"H":i=("0"+s.getHours()).slice(-2);break;case"i":i=("0"+s.getMinutes()).slice(-2);break;case"s":i=("0"+s.getSeconds()).slice(-2);break;case"z":i=function(e){var t,i=new Date(e.getFullYear(),0,1),a=0;for(t=0;t<e.getMonth();t++)i.setMonth(t),a+=u(i);return a+e.getDate()}(s);break;case"t":i=u(s);break;case"L":i=function(e){var t,i=new Date(e.getFullYear(),0,1),a=0;for(t=0;t<12;t++)i.setMonth(t),a+=u(i);return 365===a?0:1}(s);break;case"c":a=s.getTimezoneOffset(),r=[Math.floor(Math.abs(a)/60),Math.abs(a)%60],n=a<0?"+":"-",i=s.getFullYear()+"-"+v(s.getMonth()+1,2)+"-"+v(s.getDate(),2)+"T",i+=v(s.getHours(),2)+":"+v(s.getMinutes(),2)+":"+v(s.getSeconds(),2),i+=n+v(r[0],2)+":"+v(r[1],2);break;case"r":a=s.getTimezoneOffset(),r=[Math.floor(Math.abs(a)/60),Math.abs(a)%60],n=a<0?"+":"-",i=y(m)[s.getDay()]+", "+s.getDate()+" "+y(o)[s.getMonth()]+" "+s.getFullYear()+" ",i+=v(s.getHours(),2)+":"+v(s.getMinutes(),2)+":"+v(s.getSeconds(),2)+" ",i+=n+v(r[0],2)+v(r[1],2);break;case"u":i=s.getTime();break;case"U":i=Date.parse(s)/1e3;break;case"\\":h=!0,i=d[t+1];break;default:i=e}c+=i}),c}function Q(e){return Boolean(Number(e))}function $(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);1===e.length?console.log(e[0]):console.log(e)}}(jQuery);